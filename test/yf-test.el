(require 'ert)
(require 'yf)

(ert-deftest yf-arithmetics-test ()
  (should (equal (yf-eval "1 1 +")
                 '((2 . "ANY"))))
  (should (equal (yf-eval "1 -1 +")
                 '((0 . "ANY"))))
  (should (equal (yf-eval "-10 -20 +")
                 '((-30 . "ANY"))))
  (should (equal (yf-eval "1 0 -")
                 '((1 . "ANY"))))
  (should (equal (yf-eval "-10 5 -")
                 '((-15 . "ANY"))))
  (should (equal (yf-eval "10 2 -")
                 '((8 . "ANY"))))
  (should (equal (yf-eval "3 10 -")
                 '((-7 . "ANY"))))
  (should (equal (yf-eval "40 3 -")
                 '((37 . "ANY"))))
  (should (equal (yf-eval "4 3 *")
                 '((12 . "ANY"))))
  (should (equal (yf-eval "2 3 +")
                 '((5 . "ANY")))))

(ert-deftest yf-sum-test ()
  (should (equal (yf-eval "sum") '()))
  (should (equal (yf-eval "10 sum")
                 '((10 . "ANY"))))
  (should (equal (yf-eval "2 3 4 5 sum")
                 '((14 . "ANY"))))
  (should (equal (yf-eval "4 USD 1 USD 6 EUR 2 EUR sum")
                 '((8 . "EUR") (5 . "USD"))))
  (should (equal (yf-eval "4 USD 1 USD 10 GBP 6 EUR 2 EUR sum")
                 '((8 . "EUR") (10 . "GBP") (5 . "USD"))))
  (should (equal (yf-eval "4 USD 2 1 USD 10 GBP 6 EUR 2 EUR 1 sum")
                 '((9 . "EUR") (10 . "GBP") (7 . "USD"))))
  (should (equal (yf-eval "1 GBP 5 USD 8 HUF 10 EUR 20 EUR 30 EUR sum")
                 '((60 . "EUR") (8 . "HUF") (5 . "USD") (1 . "GBP")))))

(ert-deftest yf-stack-test ()
  (should (equal (yf-eval "4 dup")
                 '((4 . "ANY") (4 . "ANY"))))
  (should (equal (yf-eval "3 dup *")
                 '((9 . "ANY"))))
  (should (equal (yf-eval "6 7 swap")
                 '((6 . "ANY") (7 . "ANY"))))
  (should (equal (yf-eval "6 7 swap swap")
                 '((7 . "ANY") (6 . "ANY"))))
  (should (equal (yf-eval "3 7 swap -")
                 '((4 . "ANY"))))
  (should (equal (yf-eval "1 2 over")
                 '((1 . "ANY") (2 . "ANY") (1 . "ANY"))))
  (should (equal (yf-eval "3 drop") nil)))

(ert-deftest yf-depth-test ()
  (should (equal (yf-eval "depth")
                 '((0 . "ANY"))))
  (should (equal (yf-eval "0 depth")
                 '((1 . "ANY") (0 . "ANY"))))
  (should (equal (yf-eval "1 1 1 1 depth")
                 '((4 . "ANY")
                   (1 . "ANY") (1 . "ANY") (1 . "ANY") (1 . "ANY")))))

(ert-deftest yf-clear-test ()
  (should (equal (yf-eval "1 2 3 4 5 clear depth")
                 '((0 . "ANY")))))

(ert-deftest yf-comment-test ()
  (should (equal (yf-eval
                  "( comment 1 ) 3
                   ( comment 2 ) 4
                   ( comment 3 ) +
                   ( comment 4 )")
                 '((7 . "ANY")))))

(ert-deftest yf-multi-line-comment-test ()
  (should (equal (yf-eval
                  "( comment \n 1 2 3 \n ) \n 3 2 +
                   ( comment .. )")
                 '((5 . "ANY")))))

(ert-deftest yf-sumprod-test ()
  (should (equal (yf-eval "sumprod") '()))
  (should (equal (yf-eval "2 3 sumprod") '((6 . "ANY"))))
  (should (equal (yf-eval "2 3 4 sumprod") '((14 . "ANY"))))
  (should (equal (yf-eval "2 3 4 5 sumprod") '((26 . "ANY"))))
  (should (equal (yf-eval "2 3 4 5 6 sumprod") '((44 . "ANY"))))
  (should (equal (yf-eval "2 3 4 5 6 7 sumprod") '((68 . "ANY")))))
